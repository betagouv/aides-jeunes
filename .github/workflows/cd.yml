name: "Continuous Deployment"
on:
  push:
    branches: [master]
env:
  SSH_HOST: solstice.mes-aides.1jeune1solution.beta.gouv.fr
  SSH_USER: root

jobs:
  install:
    name: Deployment
    runs-on: ubuntu-20.04
    shell: bash
    steps:
      - run: |
          mkdir -p ~/.ssh/
          echo "${{ secrets.PRODUCTION_DEPLOY_KEY }}" > ~/.ssh/deployment.key
          chmod 600 ~/.ssh/deployment.key
          cat >>~/.ssh/config <<END
          Host solstice
            HostName ${{ env.PRODUCTION_DEPLOY_KEY }}
            User ${{ env.SSH_USER }}
            IdentityFile ~/.ssh/deployment.key
            StrictHostKeyChecking no
          END
          ssh ${{ env.SSH_USER }}@${{ env.PRODUCTION_DEPLOY_KEY }}
