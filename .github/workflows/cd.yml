name: "Continuous Deployment"
on:
  push:
    branches: [master]
env:
  SSH_HOST: solstice.mes-aides.1jeune1solution.beta.gouv.fr
  SSH_USER: root

jobs:
  install:
    name: Deployment
    runs-on: ubuntu-20.04
    steps:
      - name: Deployment
        shell: bash
        run: |
          mkdir -p ~/.ssh/
          touch ~/.ssh/known_hosts
          echo "${{ secrets.PRODUCTION_DEPLOY_KEY }}" > ~/.ssh/deployment.key
          chmod 600 ~/.ssh/deployment.key
          ssh-keygen -R ${{ env.SSH_HOST }}
          ssh ${{ env.SSH_USER }}@${{ env.SSH_HOST }} -tt -i ~/.ssh/deployment.key -f "exit"
